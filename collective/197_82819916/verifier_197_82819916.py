import sys
from pathlib import Path

# Ensure parent dir (re-arc) is on sys.path so dsl resolves when run directly
sys.path.append(str(Path(__file__).resolve().parents[1]))

from dsl import *

def verify_82819916(I: Grid) -> Grid:
    x0 = frontiers(I)
    x1 = sfilter(x0, hline)
    x2 = size(x1)
    x3 = positive(x2)
    x4 = branch(x3, identity, dmirror)
    x5 = x4(I)
    x6 = frontiers(I)
    x7 = merge(x6)
    x8 = mostcolor(x7)
    x9 = matcher(identity, x8)
    x10 = rbind(sfilter, x9)
    x11 = compose(size, x10)
    x12 = argmin(x5, x11)
    x13 = repeat(x12, ONE)
    x14 = asobject(x13)
    x15 = palette(x14)
    x16 = totuple(x15)
    x17 = first(x16)
    x18 = last(x16)
    x19 = fgpartition(x5)
    x20 = merge(x19)
    x21 = toindices(x20)
    x22 = apply(first, x21)
    x23 = lbind(sfilter, x20)
    x24 = compose(first, last)
    x25 = lbind(matcher, x24)
    x26 = compose(x23, x25)
    x27 = apply(x26, x22)
    x28 = lbind(shift, x14)
    x29 = chain(x28, toivec, uppermost)
    x30 = matcher(first, x17)
    x31 = rbind(sfilter, x30)
    x32 = rbind(compose, last)
    x33 = lbind(rbind, contained)
    x34 = chain(toindices, x31, x29)
    x35 = chain(x32, x33, x34)
    x36 = fork(sfilter, identity, x35)
    x37 = compose(color, x36)
    x38 = compose(x31, x29)
    x39 = fork(recolor, x37, x38)
    x40 = fork(other, palette, x37)
    x41 = compose(x31, x29)
    x42 = fork(difference, x29, x41)
    x43 = fork(recolor, x40, x42)
    x44 = fork(combine, x39, x43)
    x45 = mapply(x44, x27)
    x46 = paint(x5, x45)
    x47 = x4(x46)
    return x47